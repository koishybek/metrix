# План финальной доработки приложения Metrix (ESEP Style)

Мы приведем приложение в полное соответствие с вашими требованиями и предоставленными макетами.

## 1. Исправление логики и UX
*   **Изоляция истории поиска**: История поиска будет храниться в `localStorage` с привязкой к ID пользователя или очищаться при выходе, чтобы новый клиент не видел чужие запросы.
*   **Обработка ошибок при добавлении**: Если счётчик не найден, вместо "неизвестной ошибки" будем показывать понятное сообщение "Прибор не найден в базе".

## 2. Редизайн Личного Кабинета (в точности как на фото)
Мы переделаем структуру `Cabinet.tsx` и создадим новые компоненты:

### Вкладка "Мои счётчики" (Главная)
*   **Список лицевых счетов**: Карточки в стиле фото 2 (белые плашки с цветной полосой слева, номер Л/С крупно, адрес, статус).
*   **Кнопка "Прикрепить лицевой счет"**: Большая синяя кнопка внизу списка.

### Экран "Детали счётчика" (При клике на карточку)
*   **Шапка**: Л/С, ФИО владельца, Адрес, Тип воды (с иконкой).
*   **Вкладки внутри деталей**:
    *   `Информация`: Технические данные (модель, серийник).
    *   `Показания`: Текущие показания, дата, поле ввода для новых показаний (как на фото 3), кнопка "Подать заявку".
    *   `Уведомления`: История событий по этому счётчику.
*   **График и История**: Оставим их внизу или во вкладке "Показания".

### Вкладка "Услуги"
*   Список услуг как на фото 1 (Консультация, Поверка и т.д.).
*   **Форма заявки**: При клике на услугу открывается модальное окно с выбором прибора (если нужно) и комментарием.
*   **Отправка**: Реализуем имитацию отправки (сохранение в Firebase `service_requests`), чтобы админ их видел.

## 3. Вкладка "Профиль"
*   Редактирование Email.
*   Статистика запросов.

## 4. Техническая реализация
*   Обновим `MeterListItem` для точного соответствия дизайну.
*   Создадим новый компонент `MeterDetailView` для экрана деталей (фото 3).
*   Настроим `AuthContext` для правильной очистки сессии.

Я начну с исправления критических багов (история, ошибки), а затем переверстаю кабинет.